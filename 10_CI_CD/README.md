# Непрерывные разработка и доставка (CI / CD)

- [Непрерывные разработка и доставка (CI / CD)](#непрерывные-разработка-и-доставка-ci--cd)
  - [Непрерывная интеграция](#непрерывная-интеграция)
    - [Организация непрерывной интеграции](#организация-непрерывной-интеграции)
    - [Преимущества и недостатки непрерывной интеграции](#преимущества-и-недостатки-непрерывной-интеграции)
  - [Непрерывная доставка](#непрерывная-доставка)
  - [Пример процесса CI / CD](#пример-процесса-ci--cd)
    - [Организация кода](#организация-кода)
    - [Примерная модель](#примерная-модель)
    - [Инструменты](#инструменты)
    - [Инфраструктура для CI / CD](#инфраструктура-для-ci--cd)
  - [Использование контейнеров в CI / CD процессах](#использование-контейнеров-в-ci--cd-процессах)
  - [Библиография](#библиография)

Современная разработка программных продуктов похожа на организацию конвейерного производства. Каждый этап разработки программного обеспечения должен быть автоматизирован и интегрирован в общий процесс. Для этого используются специализированные инструменты и технологии, такие как _непрерывная интеграция_ (CI) и _непрерывное развертывание_ (CD).

## Непрерывная интеграция

__Непрерывная интеграция__ (_Continuous Integration_, CI) — это практика разработки программного обеспечения, при которой изменения кода разработчиков интегрируются в общую кодовую базу несколько раз в день. Каждая интеграция проверяется автоматизированными сборками и тестами, что позволяет выявлять и исправлять ошибки быстрее.

Обычно над проектом работают независимо сразу несколько разработчиков, каждый из которых может по нескольку раз в день вносить изменения в код. Чтобы избежать конфликтов и ошибок при интеграции изменений, используется практика непрерывной интеграции. Эта практика предполагает при каждом изменении кода автоматически запускать сборку и тестирование программного обеспечения.

### Организация непрерывной интеграции

Для организации процесса непрерывной интеграции необходимо выполнять следующие требования:

- использовать систему контроля версий для хранения исходного кода;
- настроить автоматическую сборку и тестирование кода при каждом изменении.

При непрерывной интеграции на выделенном сервере запускается специализированная служба, которая по событию выполняет следующие шаги:

1. Получение исходного кода из системы контроля версий;
2. Сборка программного обеспечения;
3. Развертывание программного обеспечения в тестовой среде;
4. Запуск автоматических тестов;
5. Отправка отчета о результатах тестирования разработчикам.

Могут также существовать сборки по расписанию (_daily build_ или _nightly build_). Это позволяет уменьшить нагрузку на сервер непрерывной интеграции и ускорить процесс разработки.

### Преимущества и недостатки непрерывной интеграции

У непрерывной интеграции выделяют следующие преимущества:

- быстрое выявление и исправление ошибок;
- немедленный и регулярный прогон тестов;
- постоянное наличие текущей стабильной версии программного обеспечения;
- немедленный эффект от неполного кода приучает разработчиков к работе в итеративном режиме.

Недостатки непрерывной интеграции:

- дополнительные затраты на поддержку работы непрерывной интеграции;
- необходимость в дополнительных ресурсах для обеспечения непрерывной интеграции.

## Непрерывная доставка

__Непрерывная доставка__ (_Continuous Delivery_, CD) — это практика разработки программного обеспечения, при которой каждое изменение кода проходит автоматизированные тесты на соответствие стандартам качества и безопасности и готово к выпуску в продукцию. Это позволяет разработчикам быстрее и надежнее доставлять изменения пользователям.

Кроме непрерывной доставки также может быть организовано __непрерывное развертывание__ (Continuous Deployment), при котором каждое изменение кода автоматически разворачивается в продукцию без участия разработчиков. Это позволяет сократить время между написанием кода и его выпуском, а также упростить процесс релиза. Однако непрерывное развертывание требует более тщательного контроля качества и безопасности кода.

Разница между непрерывной доставкой и непрерывным развертыванием заключается в том, что в первом случае разработчики решают, когда выпустить изменения в продукцию, а во втором случае это происходит автоматически.

В практике организация процессов CI / CD накладывает дополнительные требования на инфраструктуру и процессы разработки.

## Пример процесса CI / CD

### Организация кода

Один из способов организации работы с кодом может быть следующим:

1. Существует главная ветка разработки (например, `main` или `master`);
2. При разработки какой-либо функциональности создается отдельная ветка на основе главной ветки (например, `feature-branch`);
3. После завершения разработки функциональности создаётся запрос на слияние (Pull Request) в главную ветку;
4. После проверки кода и успешного прохождения тестов запрос на слияние сливается в главную ветку;
5. После слияния в главную ветку запускается процесс сборки и тестирования программного обеспечения;
6. При успешном прохождении тестов создаётся релизная ветка программного обеспечения (или помечается тегом релиза);
7. Создание релизной ветки запускает процесс развёртывания программного обеспечения в производственную среду.

### Примерная модель

Организация процесса CI / CD может быть представлена следующими окружениями:

- __local__ - локальная среда разработки, установленная у каждого разработчика на компьютере;
- __qa__ - среда для интеграции новой функциональности;
- __staging__ - среда для тестирования новой функциональности;
- __production__ - среда для развертывания новой функциональности.

Разработчики работают в локальной среде, где создают новую функциональность и выполняют тестирование.

После завершения разработки новой функциональности создается запрос на слияние в ветку `main`. Создание запроса на слияние запускает процесс сборки и тестирования программного обеспечения в среде `qa`. В среде `qa` запускаются автоматические тесты, которые проверяют работоспособность новой функциональности.

При успешном прохождении тестов в среде `qa`  выполняется слияние веток. После слияния веток код из ветки `main` развертывается в среде `staging`.

Среда `staging` практически не отличается от среды `production`, за исключением того, что в ней разворачивается новая функциональность для тестирования. Тестирование в среде `staging` выполняется вручную.

При успешном прохождении тестов в среде `staging` создается релизная ветка программного обеспечения, которая запускает процесс развертывания программного обеспечения в среде `production`.

### Инструменты

Для организации процессов CI / CD используются специализированные инструменты, которые позволяют автоматизировать процессы сборки, тестирования и развертывания программного обеспечения:

- __Jenkins__ — это популярный инструмент для организации процессов CI / CD.
- __GitLab CI__ — это инструмент для организации процессов CI / CD, интегрированный с системой контроля версий GitLab. GitLab CI позволяет настраивать цепочки сборки, тестирования и развертывания программного обеспечения, а также управлять ими через веб-интерфейс GitLab.
- __TeamCity__ — это инструмент для организации процессов CI / CD, разработанный компанией JetBrains.
- __CircleCI__ — это инструмент для организации процессов CI / CD, интегрированный с системой контроля версий GitHub.
- __Github Actions__ — это инструмент для организации процессов CI / CD, интегрированный с системой контроля версий GitHub. Github Actions позволяет настраивать цепочки сборки, тестирования и развертывания программного обеспечения, а также управлять ими через веб-интерфейс Github Actions.
- __AWS CodeBuild__, __AWS CodePipeline__ — это инструменты для организации процессов CI / CD, интегрированные с облачной платформой Amazon Web Services (AWS).
- __Azure DevOps__ — это инструмент для организации процессов CI / CD, интегрированный с облачной платформой Microsoft Azure.
- __Atlasian Bamboo__ — это инструмент для организации процессов CI / CD, разработанный компанией Atlasian.

### Инфраструктура для CI / CD

Для организации процессов CI / CD требуется специализированная инфраструктура, которая позволяет автоматизировать процессы сборки, тестирования и развертывания программного обеспечения:

- __Docker__ — это популярная платформа для разработки, доставки и запуска приложений в контейнерах. Docker позволяет упаковывать приложения и их зависимости в контейнеры, что упрощает развертывание и масштабирование приложений.
- __Kubernetes__ — это платформа для автоматизации развертывания, масштабирования и управления контейнеризированными приложениями. Kubernetes позволяет управлять кластером серверов, на котором запущены контейнеры, и обеспечивает высокую доступность и масштабируемость приложений.
- __Terraform__ — это инструмент для управления инфраструктурой как код. Terraform позволяет описывать инфраструктуру в виде конфигурационных файлов и автоматизировать ее развертывание и управление.
- __Ansible__ — это инструмент для автоматизации управления конфигурацией и развертывания программного обеспечения. На базе описания конфигураций (playbook) Ansible автоматически разворачивает на целевом компьютере программное обеспечение.

## Использование контейнеров в CI / CD процессах

Использование контейнеров в процессах CI / CD позволяет упростить развертывание и масштабирование приложений, а также обеспечить их изолированность и безопасность.

Контейнеры позволяют упаковывать приложения и их зависимости в изолированные среды, что упрощает их развертывание и управление. Кроме того, контейнеры позволяют запускать приложения в любой среде, где установлен Docker, что обеспечивает их переносимость и масштабируемость.  

Большинство современных инструментов для организации процессов CI / CD поддерживают работу с контейнерами, более того, они даже шаги процесса CI / CD реализуют в контейнерах, то есть:

- сама система CI / CD работает в контейнере;
- каждый шаг процесса CI / CD выполняется в отдельном контейнере;
- часто конечное приложение также упаковывается в контейнер.

При использовании контейнеров упрощается перенос приложения из одной среды в другую, так как при сборке приложения в контейнер для `qa` среды, при успешном прохождении тестов, этот же контейнер можно использовать для `staging` и `production` сред.

## Библиография

1. [Continuous Integration, Wikipedia](https://en.wikipedia.org/wiki/Continuous_integration)
2. [Continuous Delivery, Wikipedia](https://en.wikipedia.org/wiki/Continuous_delivery)
3. [Jenkins](https://www.jenkins.io/)
4. [GitLab CI](https://docs.gitlab.com/ee/ci/)
5. [TeamCity](https://www.jetbrains.com/teamcity/)
6. [CircleCI](https://circleci.com/)
7. [Github Actions](https://docs.github.com/en/actions)
8. [Docker](https://www.docker.com/)
9. [Kubernetes](https://kubernetes.io/)
10. [Terraform](https://www.terraform.io/)
11. [Ansible](https://www.ansible.com/)
12. [Continuous integration with Docker, Docker](https://docs.docker.com/build/ci/)
13. [Introduction to GitHub Actions, Docker](https://docs.docker.com/build/ci/github-actions/)
14. [MaxRokatansky, Что такое CI/CD? Разбираемся с непрерывной интеграцией и непрерывной поставкой, Habr.com](https://habr.com/ru/companies/otus/articles/515078/)
15. [Что такое непрерывная поставка?, Microsoft](https://learn.microsoft.com/ru-ru/devops/deliver/what-is-continuous-delivery)
