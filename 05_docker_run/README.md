# Запуск контейнеризированных приложений

- [Запуск контейнеризированных приложений](#запуск-контейнеризированных-приложений)
  - [Инструменты Docker](#инструменты-docker)
  - [Сборка образа](#сборка-образа)
  - [Просмотр существующих образов](#просмотр-существующих-образов)
  - [Удаление образа](#удаление-образа)
  - [Создание контейнера](#создание-контейнера)
  - [Запуск контейнера](#запуск-контейнера)
  - [Взаимодействие с контейнером](#взаимодействие-с-контейнером)
  - [Перезапуск контейнера](#перезапуск-контейнера)
  - [Копирование файлов](#копирование-файлов)
  - [Чтение логов контейнера](#чтение-логов-контейнера)
  - [Просмотр контейнеров](#просмотр-контейнеров)
  - [Остановка контейнера](#остановка-контейнера)
  - [Удаление контейнера](#удаление-контейнера)
  - [Библиография](#библиография)

Контейнеры являются экземплярами образов. Контейнеры могут быть запущены, остановлены, перемещены и удалены. В этом разделе мы рассмотрим команды для работы с контейнерами.

## Инструменты Docker

Docker предлагает набор инструментов для управления контейнерами и используемыми контейнерами ресурсами. Можно выделить следующие инструменты Docker:

- `docker image` - управление образами;
- `docker volume` - управление томами;
- `docker network` - управление сетями;
- `docker container` - управление контейнерами;
- `docker buildx` - управление процессом сборки образа;
- `docker compose` - управление многоконтейнерными приложениями;
- `docker system` - управление ресурсами Docker;
- `docker init` - создание Dockerfile на базе существующего проекта.

Что бы узнать больше о командах Docker, можно воспользоваться командой `docker --help`, а также `docker <command> --help`. Для многих команд существуют псевдонимы (en. _alias_) для более короткой записи.

## Сборка образа

| command | docker buildx build  |
| ------- | -------------------- |
| _alias_ | docker image build   |
|         | docker builder build |
|         | docker build         |

После того, как файл `Dockerfile` создан, можно приступить к сборке образа. Сборка образа выполняется обычно из командной строки и для сборки образа используется команда `docker image build`. Команда `docker image build` имеет следующий синтаксис:

```bash
docker image build [OPTIONS] PATH | URL | -
```

где `PATH` - путь к директории, в которой находится файл `Dockerfile`, `URL` - URL-адрес репозитория Git, в котором находится файл `Dockerfile`, `-` - стандартный ввод.

Команда `docker image build` имеет часто используемый псевдоним `docker build`, кроме того, она будет эквивалентна команде `docker buildx build`.

В случае, если файл `Dockerfile` находится в текущей директории, то для сборки образа достаточно выполнить команду:

```bash
docker image build .
```

В этом случае будет использована текущая директория в качестве контекста сборки и создастся образ с произвольным именем и тегом `latest`. Если необходимо задать имя и тег образа, то это можно сделать с помощью опции `-t`:

```bash
docker image build -t myimage:1.0 .
```

Для детального ознакомления с опциями команды `docker image build` можно выполнить команду:

```bash
docker image build --help
```

## Просмотр существующих образов

| command | docker image ls   |
| ------- | ----------------- |
| _alias_ | docker images     |
|         | docker image list |

Для просмотра существующих образов используется команда `docker image ls`:

```bash
docker image ls [OPTIONS] [REPOSITORY[:TAG]]
```

Эту команду также можно написать как `docker images` или `docker image list`.

Вывод команды будет содержать следующие столбцы:

- `REPOSITORIES` - имя образа, включая имя репозитория
- `TAG` - тег образа
- `IMAGE ID` - идентификатор образа
- `CREATED` - дата создания образа
- `SIZE` - размер образа

## Удаление образа

| command | docker image rm     |
| ------- | ------------------- |
| _alias_ | docker rmi          |
|         | docker image remove |

Для удаления образа используется команда `docker image rm`:

```bash
docker image rm [OPTIONS] <image_name> [<image_name>...]
```

Где `<image_name>` - это идентификатор или имя образа. Команда имеет следующие псевдонимы: `docker rmi` и `docker image remove`.

Одной командой можно удалить сразу несколько образов, для этого необходимо перечислить их имена через пробел:

```bash
docker image rm <image_name_1> <image_name_2> <image_name_3>
```

## Создание контейнера

| command | docker container create |
| ------- | ----------------------- |
| _alias_ | docker create           |

На базе существующего образа можно создать контейнер при помощи команды `docker create`:

```bash
docker container create [OPTIONS] <image_name> [ARG...]
```

В данном случае будет создан контейнер с произвольным именем на основе образа `<image_name>`. У команды `docker container create` есть псевдоним `docker create`.

Если образ не найден локально, то он будет загружен из репозитория.

Если необходимо создать контейнер с определенным именем, то используется флаг `--name`:

```bash
docker container create --name <container_name> <image_name>
```

Кроме того, при создании контейнера можно указать целый ряд опций, таких как монтирование томов, проброс портов, передача переменных окружения и т.д. Для детального ознакомления с опциями команды `docker container create` можно выполнить команду:

```bash
docker container create --help
```

## Запуск контейнера

| command | docker container start |
| ------- | ---------------------- |
| _alias_ | docker start           |

После того, как контейнер создан, его можно запустить при помощи команды `docker start`:

```bash
docker container start [OPTIONS] <container_name> [<container_name>...]
```

Часто разработчики создают и запускают контеинер одной командой.  Для этого используется команда `docker run`:

| command | docker container run |
| ------- | -------------------- |
| _alias_ | docker run           |

При запуске контейнера выполняется команда, указанная в файле `Dockerfile` одной из директив `CMD` или `ENTRYPOINT`. Если необходимо выполнить другую команду, то она указывается после имени образа:

```bash
docker container run [OPTIONS] <image_name> [<command>] [<arg...>]
```

Иногда возникает необходимость запустить контейнер в интерактивном режиме, например, для отладки. Взаимодействие с контейнером позволяет просмотреть его содержимое, выполнить в нем команды (например, установить какой-либо пакет).

Для запуска контейнера в интерактивном режиме используется флаг `-it`, который объединяет два флага `-i` (interactive) и `-t` (pseudo-TTY):

```bash
docker container run -it <image_name> <command>
```

Например, для запуска контейнера с образом `ubuntu` в интерактивном режиме используется команда:

```bash
docker container run -it ubuntu /bin/bash
```

В данном случае будет создан и запущен контейнер с произвольным именем на основе образа `<image_name>`. Если образ не найден локально, то он будет загружен из репозитория.

Для запуска контейнера в фоновом режиме используется флаг `-d`:

```bash
docker run -d <image_name>
```

Если необходимо запустить контейнер с определенным именем, то используется флаг `--name`:

```bash
docker run -d --name <container_name> <image_name>
```

В этом случае будет создан и запущен контейнер с определенным именем `<container_name>` на основе образа `<image_name>`.

## Взаимодействие с контейнером

| command | docker container exec |
| ------- | --------------------- |
| _alias_ | docker exec           |

Взаимодействовать можно только с запущенным контейнером. Для этого необходимо знать его имя или идентификатор. Имя контейнера можно задать при создании контейнера с помощью флага `--name`, а идентификатор контейнера можно узнать при помощи команды `docker ps`.

Выполнить команду внутри контейнера можно при помощи команды `docker exec`:

```bash
docker exec <container_name> <command>
```

## Перезапуск контейнера

| command | docker container restart |
| ------- | ------------------------ |
| _alias_ | docker restart           |

Для перезапуска контейнера используется команда `docker restart`. Например, для перезапуска контейнера с именем `my_container` используется следующая команда:

```bash
docker restart my_container
```

## Копирование файлов

| command | docker container cp |
| ------- | ------------------- |
| _alias_ | docker cp           |

Для копирования файлов используется команда `docker cp`. Общий синтаксис команды `docker cp` выглядит следующим образом:

```bash
docker cp <source> <destination>
```

Например, для копирования файла `file.txt` из контейнера с именем `my_container` в текущий каталог используется следующая команда:

```bash
docker cp my_container:/path/to/file.txt .
```

В случае, если необходимо скопировать `file.txt` из хоста в контейнер с именем `my_container` из текущего каталога используется следующая команда:

```bash
docker cp file.txt my_container:/path/to/file.txt
```

## Чтение логов контейнера

| command | docker container logs |
| ------- | --------------------- |
| _alias_ | docker logs           |

Для чтения логов контейнера используется команда `docker logs`. Например, для чтения логов контейнера с именем `my_container` используется следующая команда:

```bash
docker logs my_container
```

Если необходимо просматривать логи в реальном времени, то используется флаг `-f`:

```bash
docker logs -f my_container
```

## Просмотр контейнеров

| command | docker container ls   |
| ------- | --------------------- |
| _alias_ | docker ps             |
|         | docker container list |
|         | docker container ps   |

Для просмотра запущенных контейнеров используется команда `docker ps`:

```bash
docker ps
```

Вывод команды будет содержать следующие столбцы:

- `CONTAINER ID` - идентификатор контейнера
- `IMAGE` - имя образа
- `COMMAND` - команда, запущенная в контейнере
- `CREATED` - дата создания контейнера
- `STATUS` - статус контейнера
- `PORTS` - привязанные порты
- `NAMES` - имя контейнера

Если необходимо просмотреть все контейнеры, включая остановленные, то используется флаг `-a`:

```bash
docker ps -a
```

## Остановка контейнера

| command | docker container stop |
| ------- | --------------------- |
| _alias_ | docker stop           |

Для остановки контейнера используется команда `docker stop`:

```bash
docker stop <container_name>
```

Одной командой можно остановить сразу несколько контейнеров, для этого необходимо перечислить их имена через пробел:

```bash
docker stop <container_name_1> <container_name_2> <container_name_3>
```

## Удаление контейнера

| command | docker container rm     |
| ------- | ----------------------- |
| _alias_ | docker rm               |
|         | docker container remove |

Для удаления контейнера используется команда `docker rm`:

```bash
docker rm <container_name>
```

Одной командой можно удалить сразу несколько контейнеров, для этого необходимо перечислить их имена через пробел:

```bash
docker rm <container_name_1> <container_name_2> <container_name_3>
```

## Библиография

1. [How do I run a container?, docker.com](https://docs.docker.com/guides/walkthroughs/run-a-container/)
2. [Getting started guide, docker.com](https://docs.docker.com/get-started/)
3. [Запуск контейнера Docker, losst.pro, 2020](https://losst.pro/zapusk-kontejnera-docker)
4. [Docker CLI, docker.com](https://docs.docker.com/reference/cli/docker/)
